# Migration `20200331230339-prisma2-migration`

This migration has been generated by Rostislav Klein at 3/31/2020, 11:03:39 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
    "email" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text   ,
    "password" text  NOT NULL ,
    "role" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Material" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL ,
    "price" Decimal(65,30)  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Order" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "customerId" text   ,
    "id" text  NOT NULL ,
    "note" text   ,
    "number" integer  NOT NULL ,
    "shippedAt" timestamp(3)   ,
    "status" text  NOT NULL ,
    "totalPrice" Decimal(65,30)  NOT NULL ,
    "totalTax" Decimal(65,30)  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "urgency" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."OrderItem" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "height" Decimal(65,30)   ,
    "id" text  NOT NULL ,
    "materialId" text   ,
    "name" text   ,
    "orderId" text  NOT NULL ,
    "pieces" integer   ,
    "totalPrice" Decimal(65,30)  NOT NULL ,
    "totalTax" Decimal(65,30)  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL ,
    "width" Decimal(65,30)   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."ProductionLog" (
    "action" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "id" text  NOT NULL ,
    "orderItemId" text  NOT NULL ,
    "pieces" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Customer" (
    "allowedBankPayments" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "email" text   ,
    "id" text  NOT NULL ,
    "identificationNumber" text   ,
    "name" text   ,
    "note" text   ,
    "personName" text   ,
    "phone" text   ,
    "taxIdentificationNumber" text   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Address" (
    "city" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdByUserId" text  NOT NULL ,
    "customerId" text  NOT NULL ,
    "id" text  NOT NULL ,
    "isPrimary" boolean  NOT NULL DEFAULT false,
    "number" text   ,
    "postNumber" text   ,
    "state" text   ,
    "street" text   ,
    "updatedAt" timestamp(3)  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Order.number" ON "public"."Order"("number")

ALTER TABLE "public"."Material" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("materialId")REFERENCES "public"."Material"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("orderId")REFERENCES "public"."Order"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ProductionLog" ADD FOREIGN KEY ("orderItemId")REFERENCES "public"."OrderItem"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."ProductionLog" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Customer" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("customerId")REFERENCES "public"."Customer"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("createdByUserId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200326234505-added-production-log..20200331230339-prisma2-migration
--- datamodel.dml
+++ datamodel.dml
@@ -1,35 +1,13 @@
-// This is your Prisma schema file,
-// learn more about it in the docs: https://pris.ly/d/prisma-schema
-
-// The `datasource` block is used to specify the connection to your DB.
-// Set the `provider` field to match your DB type: "postgresql", "mysql" or "sqlite".
-// The `url` field must contain the connection string to your DB.
-// Learn more about connection strings for your DB: https://pris.ly/connection-strings
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
-// Other examples for connection strings are:
-// SQLite: url = "***"
-// MySQL:  url = "***"
-// You can also use environment variables to specify the connection string: https://pris.ly/prisma-schema#using-environment-variables
-
-// By adding the `generator` block, you specify that you want to generate Prisma's DB client.
-// The client is generated by runnning the `prisma generate` command and will be located in `node_modules/@prisma` and can be imported in your code as:
-// import { Prisma Client } from '@prisma/client'
 generator client {
   provider = "prisma-client-js"
 }
-// Next steps:
-// 1. Add your DB connection string as the `url` of the `datasource` block
-// 2. Run `prisma2 introspect` to get your data model into the schema (this will override this file and delete all comments!)
-// 3. Run `prisma2 generate` to generate Prisma Client JS
-// 4. Start using Prisma Client JS in your applicatio
-
-
 model User {
   id       String  @id @default(cuid())
   role     String
   email    String  @unique
@@ -42,15 +20,17 @@
   name      String
   price     Float
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
-  createdBy User
+  createdBy User @relation(fields: [createdByUserId], references: [id])
+  createdByUserId String
 }
 model Order {
   id         String      @id @default(cuid())
   number     Int         @unique
-  customer   Customer?
+  customer   Customer?   @relation(fields: [customerId], references: [id])
+  customerId String?
   shippedAt  DateTime?
   totalPrice Float
   totalTax   Float
   note       String?
@@ -58,32 +38,39 @@
   urgency    Int         @default(0)
   status     String
   createdAt  DateTime    @default(now())
   updatedAt  DateTime    @updatedAt
-  createdBy  User
+  createdBy User @relation(fields: [createdByUserId], references: [id])
+  createdByUserId String
 }
 model OrderItem {
   id         String    @id @default(cuid())
-  material   Material?
+  material   Material? @relation(fields: [materialId], references: [id])
+  materialId String? 
   totalPrice Float
   totalTax   Float
   name       String?
   width      Float?
   height     Float?
   pieces     Int?
+  order      Order @relation(fields: [orderId], references: [id])
+  orderId    String 
   createdAt  DateTime  @default(now())
   updatedAt  DateTime  @updatedAt
-  createdBy  User
+  createdBy User @relation(fields: [createdByUserId], references: [id])
+  createdByUserId String
 }
 model ProductionLog {
   id         String    @id @default(cuid())
-  orderItem  OrderItem
+  orderItem  OrderItem @relation(fields: [orderItemId], references: [id])
+  orderItemId String 
   action     String
   pieces     Int
   createdAt  DateTime  @default(now())
-  createdBy  User
+  createdBy User @relation(fields: [createdByUserId], references: [id])
+  createdByUserId String
 }
 model Customer {
   id                      String    @id @default(cuid())
@@ -95,10 +82,10 @@
   taxIdentificationNumber String?
   allowedBankPayments     Boolean   @default(false)
   address                 Address[]
   note                    String?
-  specialPrice            Material[]
-  createdBy               User
+  createdBy               User      @relation(fields: [createdByUserId], references: [id])
+  createdByUserId         String
   createdAt               DateTime  @default(now())
   updatedAt               DateTime  @updatedAt
 }
@@ -108,9 +95,12 @@
   number     String?
   city       String?
   state      String?
   postNumber String?
+  customer   Customer   @relation(fields: [customerId], references: [id])
+  customerId String
   isPrimary  Boolean  @default(false)
-  createdBy  User
+  createdBy  User @relation(fields: [createdByUserId], references: [id])
+  createdByUserId String
   createdAt  DateTime @default(now())
   updatedAt  DateTime @updatedAt
 }
```


