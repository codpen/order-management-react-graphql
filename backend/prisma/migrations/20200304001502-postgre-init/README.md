# Migration `20200304001502-postgre-init`

This migration has been generated by Rostislav Klein at 3/4/2020, 12:15:02 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
    "email" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "name" text   ,
    "password" text  NOT NULL DEFAULT '',
    "role" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Material" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "price" Decimal(65,30)  NOT NULL DEFAULT 0,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Order" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "customer" text   ,
    "id" text  NOT NULL ,
    "note" text   ,
    "number" integer  NOT NULL DEFAULT 0,
    "shippedAt" timestamp(3)   ,
    "status" text  NOT NULL DEFAULT '',
    "totalPrice" Decimal(65,30)  NOT NULL DEFAULT 0,
    "totalTax" Decimal(65,30)  NOT NULL DEFAULT 0,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "urgency" integer  NOT NULL DEFAULT 0,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."OrderItem" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "height" Decimal(65,30)   ,
    "id" text  NOT NULL ,
    "material" text   ,
    "name" text   ,
    "order" text   ,
    "pieces" integer   ,
    "totalPrice" Decimal(65,30)  NOT NULL DEFAULT 0,
    "totalTax" Decimal(65,30)  NOT NULL DEFAULT 0,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "width" Decimal(65,30)   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."ImagePreview" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "id" text  NOT NULL ,
    "name" text   ,
    "orderItem" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Customer" (
    "allowedBankPayments" boolean  NOT NULL DEFAULT false,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "email" text   ,
    "id" text  NOT NULL ,
    "identificationNumber" text   ,
    "name" text   ,
    "note" text   ,
    "personName" text   ,
    "phone" text   ,
    "taxIdentificationNumber" text   ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."Address" (
    "city" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "createdBy" text  NOT NULL ,
    "customer" text   ,
    "id" text  NOT NULL ,
    "isPrimary" boolean  NOT NULL DEFAULT false,
    "number" text   ,
    "postNumber" text   ,
    "state" text   ,
    "street" text   ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE UNIQUE INDEX "User.email" ON "public"."User"("email")

CREATE UNIQUE INDEX "Order.number" ON "public"."Order"("number")

ALTER TABLE "public"."Material" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Order" ADD FOREIGN KEY ("customer")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("material")REFERENCES "public"."Material"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."OrderItem" ADD FOREIGN KEY ("order")REFERENCES "public"."Order"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "public"."ImagePreview" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."ImagePreview" ADD FOREIGN KEY ("orderItem")REFERENCES "public"."OrderItem"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Customer" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("createdBy")REFERENCES "public"."User"("id") ON DELETE RESTRICT  ON UPDATE CASCADE

ALTER TABLE "public"."Address" ADD FOREIGN KEY ("customer")REFERENCES "public"."Customer"("id") ON DELETE SET NULL  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200304001502-postgre-init
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,116 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+// The `datasource` block is used to specify the connection to your DB.
+// Set the `provider` field to match your DB type: "postgresql", "mysql" or "sqlite".
+// The `url` field must contain the connection string to your DB.
+// Learn more about connection strings for your DB: https://pris.ly/connection-strings
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+// Other examples for connection strings are:
+// SQLite: url = "sqlite:./dev.db"
+// MySQL:  url = "mysql://johndoe:johndoe@localhost:3306/mydb"
+// You can also use environment variables to specify the connection string: https://pris.ly/prisma-schema#using-environment-variables
+
+// By adding the `generator` block, you specify that you want to generate Prisma's DB client.
+// The client is generated by runnning the `prisma generate` command and will be located in `node_modules/@prisma` and can be imported in your code as:
+// import { Prisma Client } from '@prisma/client'
+generator client {
+  provider = "prisma-client-js"
+}
+
+// Next steps:
+// 1. Add your DB connection string as the `url` of the `datasource` block
+// 2. Run `prisma2 introspect` to get your data model into the schema (this will override this file and delete all comments!)
+// 3. Run `prisma2 generate` to generate Prisma Client JS
+// 4. Start using Prisma Client JS in your applicatio
+
+
+model User {
+  id       String  @id @default(cuid())
+  role     String
+  email    String  @unique
+  password String
+  name     String?
+}
+
+model Material {
+  id        String   @id @default(cuid())
+  name      String
+  price     Float
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  createdBy User
+}
+
+model Order {
+  id         String      @id @default(cuid())
+  number     Int         @unique
+  customer   Customer?
+  shippedAt  DateTime?
+  totalPrice Float
+  totalTax   Float
+  note       String?
+  items      OrderItem[]
+  urgency    Int         @default(0)
+  status     String
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  createdBy  User
+}
+
+model OrderItem {
+  id         String    @id @default(cuid())
+  material   Material?
+  totalPrice Float
+  totalTax   Float
+  name       String?
+  width      Float?
+  height     Float?
+  pieces     Int?
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  createdBy  User
+}
+
+model ImagePreview {
+  id        String    @id @default(cuid())
+  name      String?
+  url       String
+  orderItem OrderItem
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  createdBy User
+}
+
+model Customer {
+  id                      String    @id @default(cuid())
+  name                    String?
+  personName              String?
+  phone                   String?
+  email                   String?
+  identificationNumber    String?
+  taxIdentificationNumber String?
+  allowedBankPayments     Boolean   @default(false)
+  address                 Address[]
+  note                    String?
+  createdBy               User
+  createdAt               DateTime  @default(now())
+  updatedAt               DateTime  @updatedAt
+}
+
+model Address {
+  id         String   @id @default(cuid())
+  street     String?
+  number     String?
+  city       String?
+  state      String?
+  postNumber String?
+  isPrimary  Boolean  @default(false)
+  createdBy  User
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+}
```


