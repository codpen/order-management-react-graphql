# Migration `20200224231253-order-items---previews`

This migration has been generated by Rostislav Klein at 2/24/2020, 11:12:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE `db`.`Material` (
    `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `createdBy` varchar(191) NOT NULL ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191) NOT NULL DEFAULT '' ,
    `price` Decimal(65,30) NOT NULL DEFAULT 0 ,
    `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `db`.`OrderItem` (
    `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `createdBy` varchar(191) NOT NULL ,
    `height` Decimal(65,30)   ,
    `id` varchar(191) NOT NULL  ,
    `material` varchar(191) NOT NULL ,
    `name` varchar(191)   ,
    `order` varchar(191)  ,
    `pieces` int   ,
    `totalPrice` Decimal(65,30) NOT NULL DEFAULT 0 ,
    `totalTax` Decimal(65,30) NOT NULL DEFAULT 0 ,
    `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `urgency` int NOT NULL DEFAULT 0 ,
    `width` Decimal(65,30)   ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

CREATE TABLE `db`.`ImagePreviews` (
    `createdAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `createdBy` varchar(191) NOT NULL ,
    `id` varchar(191) NOT NULL  ,
    `name` varchar(191)   ,
    `orderItem` varchar(191) NOT NULL ,
    `updatedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    `url` varchar(191) NOT NULL DEFAULT '' ,
    PRIMARY KEY (`id`)
) 
DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci

ALTER TABLE `db`.`Order` ADD COLUMN `note` varchar(191) NOT NULL DEFAULT '' ,
ADD COLUMN `shippedAt` datetime(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,
ADD COLUMN `status` varchar(191) NOT NULL DEFAULT 'NEW' ,
ADD COLUMN `totalPrice` Decimal(65,30) NOT NULL DEFAULT 0 ,
ADD COLUMN `totalTax` Decimal(65,30) NOT NULL DEFAULT 0 ;

ALTER TABLE `db`.`Material` ADD FOREIGN KEY (`createdBy`) REFERENCES `db`.`User`(`id`) ON DELETE RESTRICT

ALTER TABLE `db`.`OrderItem` ADD FOREIGN KEY (`createdBy`) REFERENCES `db`.`User`(`id`) ON DELETE RESTRICT

ALTER TABLE `db`.`OrderItem` ADD FOREIGN KEY (`material`) REFERENCES `db`.`Material`(`id`) ON DELETE RESTRICT

ALTER TABLE `db`.`OrderItem` ADD FOREIGN KEY (`order`) REFERENCES `db`.`Order`(`id`) ON DELETE SET NULL

ALTER TABLE `db`.`ImagePreviews` ADD FOREIGN KEY (`createdBy`) REFERENCES `db`.`User`(`id`) ON DELETE RESTRICT

ALTER TABLE `db`.`ImagePreviews` ADD FOREIGN KEY (`orderItem`) REFERENCES `db`.`OrderItem`(`id`) ON DELETE RESTRICT
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200219224815-init..20200224231253-order-items---previews
--- datamodel.dml
+++ datamodel.dml
@@ -6,14 +6,14 @@
 // The `url` field must contain the connection string to your DB.
 // Learn more about connection strings for your DB: https://pris.ly/connection-strings
 datasource db {
   provider = "mysql"
-  url = "***"
+  url      = env("MYSQL_URL")
 }
 // Other examples for connection strings are:
-// SQLite: url = "***"
-// MySQL:  url = "***"
+// SQLite: url = "sqlite:./dev.db"
+// MySQL:  url = "mysql://johndoe:johndoe@localhost:3306/mydb"
 // You can also use environment variables to specify the connection string: https://pris.ly/prisma-schema#using-environment-variables
 // By adding the `generator` block, you specify that you want to generate Prisma's DB client.
 // The client is generated by runnning the `prisma generate` command and will be located in `node_modules/@prisma` and can be imported in your code as:
@@ -39,12 +39,56 @@
   password String
   name     String?
 }
+model Material {
+  id        String   @id @default(cuid())
+  name      String
+  price     Float
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  createdBy User
+}
+
+enum OrderStatus {
+  NEW ONHOLD PRINTING PROCESSING SHIPPED CANCELED DONE
+}
+
 model Order {
+  id         String      @id @default(cuid())
+  number     Int         @unique
+  customer   Customer?
+  shippedAt  DateTime
+  totalPrice Float
+  totalTax   Float
+  note       String
+  items      OrderItem[]
+  status     OrderStatus @default(NEW)
+  createdAt  DateTime    @default(now())
+  updatedAt  DateTime    @updatedAt
+  createdBy  User
+}
+
+model OrderItem {
+  id         String   @id @default(cuid())
+  material   Material
+  totalPrice Float
+  totalTax   Float
+  name       String?
+  width      Float?
+  height     Float?
+  pieces     Int?
+  urgency    Int      @default(0)
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  createdBy  User
+}
+
+model ImagePreviews {
   id        String    @id @default(cuid())
-  number    Int       @unique
-  customer  Customer?
+  name      String?
+  url       String
+  orderItem OrderItem
   createdAt DateTime  @default(now())
   updatedAt DateTime  @updatedAt
   createdBy User
 }
```


